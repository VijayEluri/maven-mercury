<project name="test" default="compile-tests" xmlns:mvn="antlib:org.apache.maven.mercury.ant.tasks" >
	
	<!--
	    this example does not include <mvn:write .../> task, which 
	    will be used to install / deploy artifacts into repositories
	    nor this example show how to configure artifact 
	     validation - for the sake of simplicity
	-->

  <target name="init">
    <property name="settings.name" value="home-settings"/>
    <property name="java.version" value="1.5"/>
    
    <property name="src" value="${basedir}/src/main/java"/>
    <property name="target" value="${basedir}/target/classes"/>
    
    <property name="test.src" value="${basedir}/src/test/java"/>
    <property name="test.target" value="${basedir}/target/test-classes"/>
  
    <!--
     | configration: repositories, ?possibly profiles 
     -->
    <mvn:settings id="work-settings">
          <mvn:localRepositoryM2  id="localRepo" path="/app/maven.repo"/>
          <mvn:remoteRepositoryM2 id="central"   url="http://repo1.maven.org/maven2"/>
    </mvn:settings>
  
    <mvn:settings id="home-settings">
          <mvn:localRepositoryM2  id="localRepo" path="/app/maven.repo"/>
          <mvn:remoteRepositoryM2 id="central"   url="http://localhost:8081/nexus/contents/groups/public"/>
    </mvn:settings>
  	
  
    <!--
     | dependency sets, identified and referred to by id - path-like structure declarations
     -->
    <mvn:dependencies id="my-libs">
      <!-- coordinates as string  -->
      <mvn:dependency name="ant:ant:1.6.5"/>
      <!-- coordinates as named attributes  -->
      <mvn:dependency groupid="asm" artifactid="asm-xml" version="[3.0,4.0)"/>
      <!-- 
       | a set of dependencies from a pom
       |  
       |    will be implemented last as mercury does not know
       |    about POMs - this will be a special read-only repository type   
      -->
      <mvn:dependency groupid="org.apache.maven" artifactid="maven" version="3.0-SNAPSHOT" pom="${basedir}/pom.xml"/>
    </mvn:dependencies>

  </target>

  <target name="compile" depends="init">
  	<!--
  	 | this is the workhorse task - creates a classpath named "compile-path"
  	 |  and adds all the transitive dependencies from "my-libs" in compile scope 
  	-->
    <mvn:resolve name="resolve-compile-deps"
                 pathid="compile-path"
                 depref="my-libs"
                 settingsref="${settings.name}"
                 />
    
    <javac srcdir="${src}"
           destdir="${target}"
           classpathref="compile-path"
           debug="on"
           source="${java.version}"
    />
  </target>
  
  <target name="compile-tests" depends="compile">  
    <!--
     | this is the workhorse task - creates a classpath named "test-path"
     |  and adds all the transitive dependencies from "my-libs" in test scope 
    -->
    <mvn:resolve name="resolve-test-deps"
                 pathid="test-path"
                 depref="my-libs"
                 settingsref="${settings.name}"
                 scope="test"
                 />
    
    <javac srcdir="${test.src}"
           destdir="${test.target}"
           classpathref="test-path"
           debug="on"
           source="${java.version}"
    />
  </target>
  
</project>